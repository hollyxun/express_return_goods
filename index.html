<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="å¿«é€’é€€è´§å•ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒAndroidå’ŒiOSé£æ ¼æˆªå›¾">
    <meta name="keywords" content="å¿«é€’,é€€è´§,æˆªå›¾,å·¥å…·">
    <meta name="author" content="Express Return Generator">
    <meta name="theme-color" content="#ffffff">
    <title>é€€è´§ç”Ÿæˆ</title>
    <!-- Import html2canvas -->
    <script src="/resource/js/html2canvas.min.js"></script>
    <!-- import Vue3 -->
    <script src="/resource/js/vue.global.min.js"></script>
    <!-- Import Element style -->
    <link rel="stylesheet" href="/resource/css/element.css"/>
    <!-- Import component library -->
    <script src="/resource/js/element.full.min.js"></script>
    <!-- Import HTML style -->
    <link rel="stylesheet" href="/resource/css/index.css"/>
    <!-- æ·»åŠ favicon -->
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“¦</text></svg>">
</head>
<body>
<div class="container" id="app">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <el-row class="page-header">
        <el-col :span="24">
            <h1 class="text-center">å¿«é€’é€€è´§å•ç”Ÿæˆå·¥å…·</h1>
            <p class="text-center text-muted">æ”¯æŒAndroidå’ŒiOSé£æ ¼æˆªå›¾</p>
        </el-col>
    </el-row>

    <el-row :gutter="20">
        <!-- Android å±å¹• -->
        <el-col :xs="24" :sm="12" :md="8" :lg="8" :xl="8" class="mb-20">
            <div class="preview-wrapper">
                <div class="android-container" id="screen-android">
                    <img class="bg-image" src="/resource/img/android-bg.png" alt="AndroidèƒŒæ™¯"/>
                    <div class="time fs14">{{content.time}}</div>
                    <div class="show" v-show="!content.show"></div>
                    <div class="address-first fs14">{{content.addressFirst}}</div>
                    <div class="address-last fs14">{{content.addressLast}}</div>
                    <div class="name fs14">{{content.name}}</div>
                    <div class="mobile fs14">{{content.mobile}}</div>
                </div>
                <div class="preview-actions">
                    <el-button type="primary" size="small" @click="onCreate('screen-android')" :loading="isLoading">
                        <i class="el-icon-camera"></i> ç”ŸæˆAndroidæˆªå›¾
                    </el-button>
                </div>
            </div>
        </el-col>

        <!-- iOS å±å¹• -->
        <el-col :xs="24" :sm="12" :md="8" :lg="8" :xl="8" class="mb-20">
            <div class="preview-wrapper">
                <div class="ios-container" id="screen-ios">
                    <img class="bg-image" src="/resource/img/ios-bg.png" alt="iOSèƒŒæ™¯"/>
                    <div class="show" v-show="!content.show"></div>
                    <div class="time fs14">{{content.time}}</div>
                    <div class="address fs14" v-html="content.address"></div>
                    <div class="name fs14">{{content.name}}</div>
                    <div class="mobile fs14">{{content.mobile}}</div>
                </div>
                <div class="preview-actions">
                    <el-button type="primary" size="small" @click="onCreate('screen-ios')" :loading="isLoading">
                        <i class="el-icon-camera"></i> ç”ŸæˆiOSæˆªå›¾
                    </el-button>
                </div>
            </div>
        </el-col>

        <!-- é…ç½®è¡¨å• -->
        <el-col :xs="24" :sm="24" :md="8" :lg="8" :xl="8">
            <el-card shadow="hover" class="form-container">
                <template #header>
                    <div class="card-header">
                        <span><i class="el-icon-setting"></i> é…ç½®é¡¹</span>
                        <span v-if="fileName" class="file-name-preview">æ–‡ä»¶å: {{fileName}}.png</span>
                    </div>
                </template>

                <el-form label-width="auto" :model="content" label-position="left" size="small">
                    <el-form-item label="å›¾æ ‡æ˜¾ç¤º">
                        <el-switch v-model="content.show" active-text="æ˜¾ç¤º" inactive-text="éšè—"></el-switch>
                    </el-form-item>

                    <el-form-item label="æ—¶é—´">
                        <el-time-picker
                                class="w250"
                                v-model="content.time"
                                format="HH:mm"
                                value-format="HH:mm"
                                placeholder="é€‰æ‹©æ—¶é—´"></el-time-picker>
                    </el-form-item>

                    <el-form-item label="å§“å">
                        <el-input v-model="content.name" class="w250" placeholder="æ”¶ä»¶äººå§“å"/>
                    </el-form-item>

                    <el-form-item label="åœ°å€(é¦–è¡Œ)">
                        <el-input v-model="content.addressFirst" class="w250" placeholder="çœå¸‚åŒºè¡—é“"/>
                    </el-form-item>

                    <el-form-item label="åœ°å€(å°¾è¡Œ)">
                        <el-input v-model="content.addressLast" class="w250" placeholder="å°åŒºæ¥¼æ ‹å•å…ƒ"/>
                    </el-form-item>

                    <el-form-item label="æ‰‹æœºå·ç ">
                        <el-input v-model="content.mobile" class="w250" placeholder="æ”¶ä»¶äººæ‰‹æœºå·"/>
                    </el-form-item>

                    <el-form-item>
                        <div class="action-buttons">
                            <el-button type="success" @click="onCreate('screen-android')" :loading="isLoading"
                                       icon="el-icon-mobile">
                                ç”ŸæˆAndroidæˆªå›¾
                            </el-button>
                            <el-button type="primary" @click="onCreate('screen-ios')" :loading="isLoading"
                                       icon="el-icon-mobile">
                                ç”ŸæˆiOSæˆªå›¾
                            </el-button>
                        </div>
                    </el-form-item>
                </el-form>

                <!-- ä½¿ç”¨è¯´æ˜ -->
                <div class="tips-section">
                    <h4><i class="el-icon-info"></i> ä½¿ç”¨è¯´æ˜</h4>
                    <ol>
                        <li>å¡«å†™è¡¨å•ä¿¡æ¯</li>
                        <li>ç‚¹å‡»å¯¹åº”æŒ‰é’®ç”Ÿæˆæˆªå›¾</li>
                        <li>å›¾ç‰‡å°†è‡ªåŠ¨ä¸‹è½½åˆ°æ‚¨çš„è®¾å¤‡</li>
                    </ol>
                </div>
            </el-card>
        </el-col>
    </el-row>

    <!-- é¡µè„š -->
    <el-row class="footer">
        <el-col :span="24">
            <p class="text-center">Â© {{new Date().getFullYear()}} é€€è´§å•ç”Ÿæˆå·¥å…· | ä½¿ç”¨ <a
                    href="https://html2canvas.hertzen.com/" target="_blank">html2canvas</a> æŠ€æœ¯</p>
        </el-col>
    </el-row>
</div>
<script>
    const {createApp, reactive, ref, onMounted, watch} = Vue;

    // æ ¼å¼åŒ–å½“å‰æ—¶é—´
    function formatCurrentTime() {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        return `${hours}:${minutes}`;
    }

    // æ ¼å¼åŒ–æ–‡ä»¶å
    function formatFileName(prefix) {
        const now = new Date();
        const dateStr = now.toISOString().slice(0, 10).replace(/-/g, '');
        const timeStr = now.toTimeString().slice(0, 8).replace(/:/g, '');
        return `${prefix}_${dateStr}_${timeStr}`;
    }

    // åˆ›å»º Vue åº”ç”¨
    createApp({
        setup() {
            // çŠ¶æ€ç®¡ç†
            const isLoading = ref(false);
            const fileName = ref('');
            const content = reactive({
                show: false,
                name: 'ç‹å°å›¾',
                addressFirst: 'å—äº¬å¸‚åŒ—æ–¹è·¯ä¹è¯åŒºäº‘æœµèŠ±å›­',
                addressLast: '20å¹¢ä¸‰å•å…ƒ403',
                mobile: '18912345678',
                address: '',
                time: formatCurrentTime(),
            });

            // è‡ªåŠ¨æ‹¼æ¥åœ°å€
            const handleAddress = () => {
                content.address = `${content.addressFirst}${content.addressLast} <span class="copy">å¤åˆ¶</span>`;
            };

            // æ›´æ–°æ–‡ä»¶å
            const updateFileName = (type) => {
                const prefix = type === 'screen-android' ? 'Android' : 'iOS';
                fileName.value = formatFileName(prefix);
            };

            // ç”Ÿå‘½å‘¨æœŸé’©å­
            onMounted(() => {
                handleAddress();
                // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡æ—¶é—´
                setInterval(() => {
                    content.time = formatCurrentTime();
                }, 60000);
            });

            // ç›‘å¬åœ°å€å˜åŒ–ï¼Œè‡ªåŠ¨æ›´æ–°
            watch(() => [content.addressFirst, content.addressLast], handleAddress);

            // æˆªå›¾åŠŸèƒ½
            const onCreate = async (id) => {
                try {
                    // è®¾ç½®åŠ è½½çŠ¶æ€
                    isLoading.value = true;
                    updateFileName(id);

                    const node = document.getElementById(id);
                    // ç¡®ä¿èŠ‚ç‚¹å­˜åœ¨
                    if (!node) {
                        throw new Error(`æ‰¾ä¸åˆ°IDä¸º${id}çš„å…ƒç´ `);
                    }

                    // ä¼˜åŒ–ç§»åŠ¨è®¾å¤‡ä½“éªŒ
                    const isMobile = window.innerWidth <= 768;
                    const scaleValue = isMobile ? window.devicePixelRatio * 1.5 : window.devicePixelRatio * 2;

                    const canvas = await html2canvas(node, {
                        useCORS: true,
                        height: node.offsetHeight,
                        width: node.offsetWidth,
                        scrollY: 0,
                        scrollX: 0,
                        scale: scaleValue, // æ ¹æ®è®¾å¤‡ç±»å‹è°ƒæ•´ç¼©æ”¾æ¯”ä¾‹
                        logging: false, // ç”Ÿäº§ç¯å¢ƒå…³é—­æ—¥å¿—
                        backgroundColor: null, // ä¿æŒé€æ˜èƒŒæ™¯
                        allowTaint: false, // ä¸å…è®¸æ±¡æŸ“
                        imageTimeout: 15000, // å›¾ç‰‡åŠ è½½è¶…æ—¶æ—¶é—´
                        onclone: (document) => {
                            // åœ¨å…‹éš†çš„æ–‡æ¡£ä¸­å¯ä»¥è¿›è¡Œé¢å¤–å¤„ç†
                            console.log('æ–‡æ¡£å·²å…‹éš†ï¼Œå‡†å¤‡æ¸²æŸ“');
                        }
                    });

                    // ä½¿ç”¨PNGæ ¼å¼ä¿å­˜ï¼Œä¿æŒé«˜è´¨é‡å’Œé€æ˜åº¦
                    const imgUrl = canvas.toDataURL('image/png', 1.0);
                    const a = document.createElement('a');
                    a.href = imgUrl;
                    a.download = `${fileName.value}.png`;
                    a.click();
                    a.remove();
                    ElementPlus.ElMessage.success('æˆªå›¾æˆåŠŸ');
                } catch (error) {
                    console.error('æˆªå›¾å¤±è´¥:', error);
                    ElementPlus.ElMessage.error(`æˆªå›¾å¤±è´¥: ${error.message || 'è¯·é‡è¯•'}`);
                } finally {
                    // æ— è®ºæˆåŠŸå¤±è´¥éƒ½é‡ç½®åŠ è½½çŠ¶æ€
                    isLoading.value = false;
                }
            };

            return {
                content,
                isLoading,
                fileName,
                onCreate
            };
        }
    })
        .use(ElementPlus)
        .mount("#app");
</script>
</body>
</html>